#put your dockerfile contents here

FROM ubuntu:latest 

RUN apt-get update && apt-get install socat gcc patchelf sudo -y
# for debugging purposes
#RUN apt-get install python3 vim tmux python3-pip gdb -y
#RUN pip3 install pwntools 

ENV USER medium-note
WORKDIR ../


COPY ./src/chal.c /chal.c

COPY ./src/ld-2.36.so /tmp
RUN mkdir -p /glibc/2.36/64/lib
RUN gcc /chal.c -o /chal
COPY ./dist/libc-2.36.so.6 /glibc/2.36/64/lib/libc.so.6

COPY ./flag.txt ./flag.txt


RUN chmod +x /chal
RUN patchelf --set-interpreter /ld-2.36.so /chal

EXPOSE 4401

CMD socat TCP-LISTEN:4401,reuseaddr,fork EXEC:"/tmp/ld-2.36.so /chal"

